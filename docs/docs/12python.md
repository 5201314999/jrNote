# python çˆ¬è™«ç³»åˆ—-å…¥é—¨æ•™ç¨‹ï¼ˆ2ï¼‰ğŸ˜„

## ä¸ªäººåæ§½

å†™å®Œç¬¬ä¸€ç¯‡ä¹‹åå‘ç°çˆ¬å›æ¥çš„å›¾ç‰‡åªæœ‰30å¤šå¼ 

![Image text](https://github.com/5201314999/jrNote/blob/master/docs/.vuepress/public/docs/py_3.jpg?raw=true)

å°è€å¼Ÿï¼Œä¸æ˜¯è‡³å°‘åº”è¯¥å‡ ç™¾å¼ å—ï¼Œè¿™ä¹ˆä¸ç»™é¢å­çš„å—ï¼Ÿï¼Ÿ

è‡ªæš´è‡ªå¼ƒï¼ˆå†·é™æ€è€ƒï¼‰ï¼ŒåŸæ¥ç½‘é¡µæ˜¯ç€‘å¸ƒæµçš„ï¼Œä¸ä¸‹æ‹‰æ»šåŠ¨æ¡ä¸ä¼šè¯·æ±‚æ›´å¤šçš„å›¾ç‰‡ï¼Œä¸€å¼€å§‹åˆå§‹åŒ–é¡µé¢åªåŠ è½½äº†30å¤šå¼ çš„å›¾ç‰‡ï¼Œè§£æç½‘é¡µimg å…ƒç´ åªèƒ½å¾—åˆ°å‡ åå¼ ï¼Œ
æ‰€ä»¥æ”¹äº†ä¸‹ä»£ç ï¼Œé¡ºä¾¿å†™äº†å…¥é—¨çˆ¬è™«ä¸‹ç¯‡(psï¼šæˆ‘æ˜¯ä¸æ˜¯å¾ˆæ£’æ£’,åšä¿¡å¿µå¿µä¸å¿˜ï¼Œå¿…æœ‰å›å“)

## å‰è¨€

æƒ³ç¼–å†™çˆ¬è™«è¿˜æ˜¯è¦æœ‰ç‚¹ç¼–ç¨‹åŸºç¡€çš„ï¼Œæ²¡åŸºç¡€çš„å¯ä»¥å…ˆçœ‹çœ‹ä¸‹é¢çš„åŸºç¡€ï¼ˆå…³é”®è¯ï¼‰èµ„æ–™ï¼Œå¹¶ä¸”è‡ªè¡Œç™¾åº¦è°·æ­Œã€‚

* 1 python åŸºæœ¬è¯­æ³•ï¼Œjson ï¼Œç½‘ç»œè¯·æ±‚åˆ†æ

    python ç±»ï¼Œæ–¹æ³•ï¼Œå˜é‡ï¼ˆç±»æ¯”java)

* 2 ä½¿ç”¨è°·æ­Œæµè§ˆå™¨æŒ‰f12 åˆ·æ–°é¡µé¢ æŸ¥çœ‹ç½‘ç»œè¯·æ±‚æ¥å£ï¼ˆxhr)ï¼Œï¼ˆæ€•å°ç™½ä¸æ‡‚æ€ä¹ˆçœ‹ï¼Œè€å¸æœºå¿«é€Ÿç•¥è¿‡ï¼‰
[è°ƒè¯•å™¨è¯´æ˜](https://www.cnblogs.com/yuanchaoyong/p/6172034.html)

* 3 æœ¬ç¯‡æ•™ç¨‹çˆ¬è™«çš„éš¾åº¦æ¯”è¾ƒä½ï¼Œå®é™…ä½¿ç”¨ä¸­å¾ˆå¤šç½‘ç«™éƒ½æœ‰é˜²ç›—é“¾æˆ–è€…åŠ å¯†æªæ–½ï¼Œç­‰ä½ æ‡‚å¾—åŸºæœ¬ç¼–ç ä¹‹åï¼Œéš¾ç‚¹å’Œæ ¸å¿ƒå°±æ˜¯ï¼šåˆ†æç½‘ç«™ï¼Œæ‰¾åˆ°ç¬¦åˆæˆ‘ä»¬å¿ƒæ„çš„æ¥å£æˆ–è€…ç½‘é¡µå…ƒç´ è¿›è¡Œè§£æ

* 4 python è§£æjsonï¼Œï¼ˆå®˜æ–¹è‡ªå¸¦æ¨¡å—ï¼Œä¸ç”¨å¦å¤–å®‰è£…ï¼‰,python3 å®‰è£…è¯­æ³• ï¼Œpython æ–‡ä»¶è¿è¡Œ è¯·æŸ¥çœ‹ä¸Šç¯‡æ•™ç¨‹**å‰è¨€**

* 5 å•å‡»è®¿é—®ï¼Œè§‚çœ‹æ¥å£æ•°æ®æ ¼å¼ï¼š[https://unsplash.com/napi/search/photos?query=girl&xp=&per_page=18461&page=1](https://unsplash.com/napi/search/photos?query=girl&xp=&per_page=18461&page=1)


## demo

ä½œä¸ºä¸€æšé’¢é“ç›´ç”·ï¼Œçˆ¬å–å…³é”®è¯å½“ç„¶æ˜¯ï¼ˆgirl) ,ä½ è¦æ˜¯æƒ³è®¾ç½®ä¸ºboyï¼Œæˆ‘ä¸€ç‚¹æ„è§éƒ½æ²¡æœ‰ã€‚
```

'''
ä¸Šç¯‡æ–‡ç« ï¼Œæ˜¯ä¸ºäº†å¿«é€Ÿå…¥é—¨å’Œè·å¾—æˆå°±æ„Ÿï¼Œåªèƒ½çˆ¬å‡ åå¼ ï¼Œè§£æäº†é¦–é¡µåˆå§‹åŒ–çš„dom å…ƒç´ ï¼Œåé¢çš„ç€‘å¸ƒæµå›¾ç‰‡æ²¡æœ‰çˆ¬åˆ°
åœ¨è¿›å…¥ç¬¬2ä¸ªdemo ä¹‹å‰å…ˆå¿«é€Ÿåˆ·äº†ä¸€épythonåŸºç¡€è¯­æ³•ï¼Œ(æˆ‘æœ‰å‰ç«¯å’Œjava çš„åŸºç¡€ï¼Œé˜…è¯»éš¾åº¦æ¯”è¾ƒä½)
ç¬¬äºŒä»½ä»£ç ï¼š
1 ä½¿ç”¨ç±»ï¼Œä¼˜åŒ–ä»£ç 

2 çˆ¬å–ç€‘å¸ƒæµæ›´å¤šå›¾ç‰‡ï¼Œæ›´å®ç”¨,ä¸å†æ˜¯è§£ædom å…ƒç´ ï¼Œè€Œæ˜¯ç›´æ¥è§£ææ¥å£è¿”å›json ç»“æœ
http://docs.python-requests.org/zh_CN/latest/user/quickstart.html
'''

import requests
import os
import time
import json

'''
    çˆ¬å–https://unsplash.com/ ä¸Šçš„ç¾å¥³å›¾ç‰‡
'''
class PicSpider:

    # å¤´éƒ¨
    headers={'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36'}  
    # å®˜ç½‘åœ°å€
    weburl:''

    def __init__(self,weburl):
        self.weburl=weburl

    # ä¿å­˜å›¾ç‰‡
    def save_img(self,url): 
        print('å¼€å§‹ä¿å­˜å›¾ç‰‡...')
        print(url)
        img = requests.get(url)
        # ä»url é‡Œè·å–å‡ºfm å­—æ®µæ˜¯å›¾ç‰‡åç¼€
        suffix=url[url.index('fm=')+3:url.index('&crop')]
        print(suffix)
        file_name = 'E:/myself/imgs/'+time.strftime("%Y%m%d-%H%M%S", time.localtime())  + '.'+suffix
        print('å¼€å§‹ä¿å­˜æ–‡ä»¶')
        f = open(file_name, 'ab')
        f.write(img.content)
        print(file_name,'æ–‡ä»¶ä¿å­˜æˆåŠŸï¼')
        f.close()

    # åˆ›å»ºæ–‡ä»¶å¤¹ 
    def mkdir(self,path): 
        path = path.strip()
        is_exists = os.path.exists(path)
        if not is_exists:
            print('åˆ›å»ºåå­—å«åš', path, 'çš„æ–‡ä»¶å¤¹')
            os.makedirs(path)
            print('åˆ›å»ºæˆåŠŸï¼')
        else:
            print(path, 'æ–‡ä»¶å¤¹å·²ç»å­˜åœ¨äº†ï¼Œä¸å†åˆ›å»º')
        
    # å¼€å§‹çˆ¬è™«
    def start_spider(self):

        self.mkdir('E:/myself/imgs')

        # æ¨¡æ‹Ÿå‘å‡ºè¯·æ±‚
        queryObj={
            'query':'girl',
            'page':1,
            'per_page':20,
            'xp':''
        }

        # å‘å‡ºç¬¬ä¸€ä¸ªè¯·æ±‚è§£æåˆ°å›¾ç‰‡æ€»é¡µæ•°
        result=requests.get(self.weburl+'/napi/search/photos',params=queryObj)
        search_result=json.loads(result.content)
        total_pages=search_result['total_pages']
        print('æŸ¥è¯¢è¯',queryObj['query'],'é¡µæ•°ä¸º:',total_pages)
        
        
        # ç¬¬ä¸€ç§æ–¹æ¡ˆ å‘å‡ºä¸€ä¸ªåˆ†é¡µè¯·æ±‚ï¼Œé¡µå¤§å°è®¾ä¸ºå›¾ç‰‡æ€»æ•°ï¼Œé¡µæ•°ç¬¬ä¸€é¡µï¼Œä¸€æ¬¡æ€§å–å›å…¨éƒ¨æœç´¢ç»“æœï¼Œè·å–åˆ°json è¿›è¡Œè§£æ(åªèƒ½è·å–åˆ°30æ¡ã€‚ã€‚ã€‚)
        # ç¬¬2ç§æ–¹æ¡ˆ åˆ†é¡µè¯·æ±‚
        for i in range(total_pages):
            queryObj['page']=i+1
            result=requests.get(self.weburl+'/napi/search/photos',params=queryObj)
            # print(result.content)
            # content=json.loads(result.content)
            # print(content['total_pages'])
            allPhoto=json.loads(result.content)
            print('è·å–åˆ°ç¬¬',i,'é¡µï¼Œé¡µå¤§å°ï¼š',len(allPhoto['results']))
            for item in allPhoto['results']:
                self.save_img(item['urls']['full'])
            queryObj['per_page']=search_result['total']
            result=requests.get(self.weburl+'/napi/search/photos',params=queryObj)
       
# è°ƒç”¨å°è£…å¥½çš„ç±»
p=PicSpider('https://unsplash.com')
p.start_spider()

```

## æˆæœ

![Image text](https://github.com/5201314999/jrNote/blob/master/docs/.vuepress/public/docs/py_3.png?raw=true)

ç›´è‡³æˆªç¨¿ï¼Œç¨‹åºä»åœ¨è¿è¡Œã€‚

## æœ€å

ä»£ç çš„å†™æ³•å…¶å®æœ‰å¾ˆå¤šç§ï¼Œä»¥ä¸Šåªæ˜¯ä¸€ç§å®ç°å†™æ³•ï¼Œå†™å¾—æ¯”è¾ƒç²—ç³™ï¼ˆæ˜¯ä¸æ˜¯å¾ˆåƒå­¦ç”Ÿå†™çš„ï¼Œæ‰‹åŠ¨æ»‘ç¨½ï¼‰ï¼Œä¾‹å¦‚è¯·æ±‚åº“ï¼Œjson çš„è§£æ å…¶å®æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥é€‰æ‹©ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæˆ‘çš„è‚¯å®šé€‚åˆæ–°æ‰‹ï¼Œè¿™è½¦å¾ˆç¨³,å†œè¯å‡†ç‹è€…æ°´å¹³ä¼šå¸¦ä¸åŠ¨é“‚é‡‘å—ã€‚

![Image text](https://github.com/5201314999/jrNote/blob/master/docs/.vuepress/public/docs/py_4.gif?raw=true)

å¹å˜˜å®Œäº†ï¼Œæ€»ç»“ï¼š

ç¼ºç‚¹ï¼š
1. çˆ¬çš„æœ‰ç‚¹æ…¢ï¼Œåªæœ‰å•çº¿ç¨‹ï¼Œio åˆæ…¢ï¼Œ
2. æ•°æ®ä¹Ÿåªæ˜¯å­˜åœ¨æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åé¢æ‰“ç®—æ”¾åˆ°mongodb æ•°æ®åº“
3. å¬è¯´çˆ¬çš„å¤ªä¹…ï¼Œip ä¼šè¢«å°ã€‚
4. æœ‰äº›ä¸œè¥¿æ˜¯åŠ å¯†çš„ï¼Œçˆ¬å›æ¥ä¹Ÿä¸ä¸€å®šçœ‹å¾—æ‡‚

ä¼˜ç‚¹ï¼š
1. å¾ˆå¤šä¸œè¥¿éƒ½èƒ½ç”¨python è„šæœ¬æ¥çˆ¬äº†ï¼Œå¯ä»¥è·å–åˆ°å¤§é‡æ•°æ®
2. å¯ä»¥ç”¨æ¥è£…é€¼ã€‚ã€‚ã€‚ï¼ˆä¾‹å¦‚æˆ‘ç°åœ¨è¿™æ ·ï¼‰



    







