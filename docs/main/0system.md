## 工作中系统架构梳理

### 1. 电子白板，文档批注，工具栏项目

#### 背景

公司领导给我们安排了一个项目任务,开发一个自己公司内部的 “电子白板”，完成之后视情况在富士康内部推广, 确定了 room----->board 的架构，权限系统有限剥离，先实现白板核心功能，实现同个房间不同用户的白板内容的同步。需要具备的功能要点如下：

1. 文档批注功能，包括对应的绘制工具（线，面，橡皮檫，缩放，拖拽，撤销，前进），文档的上传，下载
2. 会议房间管理 (权限模块)
3. 会议内容同步（websocket）

#### 难点 

1. 调研了第三方绘制库 konva,faberic, paper

    结论：采用konva，代码风格比较新

2. 白板如何加载文档的实现
    - 调研同类产品电子白板，交叉产品
        
        - OpenMeetings 
        - https://www.limitcode.com/public/demo/postil/views/postil.html
        - https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#https://app.conceptboard.com/board/9niz-c2t1-ra35-32o9-au1m#
        - Smart 白板功能
        - 腾讯在线文档编辑，发现这种编辑模式跟需求不一致，而且后台将office,ppt,excel 转成网页的技术，我们部门不能掌握，市面上大多调用微软服务来加载。

       结论：前端使用pdf 和 图片操作， 由后台负责文档转换。
3. 实现过程
    
    - 使用pdfjs 每页直接渲染进canvas 里，canvas 太多奔溃，好处导出方便，工具在不同canvas 通信复杂度提升, 转而先转图片再加载图片。
    - 整块画布图片Image 放进去,经过测试,画布的缩放是外层canvas 大小保持不变，内部坐标系调整,拖拽的实现其实是transform 偏移，可以加自己实现的div 滚动条来完善效果。


3. 常用工具的使用方法。要实现钢笔和马克笔的效果，需要一定的算法支持, 顺滑度和笔尖样式

4. 

#### 从别人学到的东西

1. 实现较复杂的功能时一定要多考虑全面
   
   1. 缩略图点开之后，是展开多个stage 还是一个stage (类似tab)
   2. 改变需求之后如何设置画布，画板填满整个屏幕，文档成为其中一个组件,怎么设计konva的结构(考虑导出保存的实现，缩放)
   3. 缩放和拖拽的实现效果

2. 对于自己不确定的实现方案，要多跟别人讨论，确定好的方案，实现难度和工作量都是能大幅度减少的。

























### 2. 统一管理,单点登录项目流程

### 3. 常规后台管理项目

### 4. 视频会议项目

* 预研 webrtc 项目 ，最后失败了！

### 5. 移动端项目
